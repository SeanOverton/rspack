import WebpackLicense from '@components/WebpackLicense';

<WebpackLicense from="https://webpack.js.org/configuration/devtool/" />

# Devtool

该选项用于控制是否并如何生成 source map，直接影响调试体验与构建性能。

如果你想进行更精细的配置，直接使用 [SourceMapDevToolPlugin](/plugins/webpack/source-map-dev-tool-plugin)/[EvalSourceMapDevToolPlugin](/plugins/webpack/eval-source-map-dev-tool-plugin)。

- **类型：**

```ts
type Devtool = 'string' | false;
```

- **默认值：** `eval`

## 决策指南

## 步骤1：是否需要调试

- 不需要 → 设置 `devtool: false`
  - 禁用所有调试信息生成
  - 构建速度最快
- 需要 → 进入步骤2

### 步骤2: 调试需求

- 快速定位模块 → 设置 `devtool: 'eval'`
  - 模块级 `//# sourceURL` 注释
  - 极快的构建速度
- 完整源码调试 → 进入步骤3

### 步骤3：生成 source map

基础配置 `devtool: 'source-map'`，支持修饰符组合：

性能优化修饰符，显著提升构建速度，推荐开发环境使用

| 修饰符 | 效果                                                           |
| ------ | -------------------------------------------------------------- |
| eval   | 模块级生成 source map，避免 chunk 级合并计算，极大提升构建性能 |
| cheap  | 仅映射行号，忽略列号计算，且不映射 loader 转换前源码           |
| module | 映射 loader 转换前源码                                         |

功能型修饰符，按需控制生成的 source map 内容

| 修饰符    | 效果                                                                       |
| --------- | -------------------------------------------------------------------------- |
| hidden    | 生成 `.map` 文件，但不添加 `//# sourceMappingURL=[url]` 注释，保护源码隐私 |
| inline    | 以 base64 内联到文件中，无独立 .map 文件                                   |
| nosources | source map 移除 `sourcesContent` 字段                                      |
| debugids  | source map 增加 `debugId` 字段                                             |

验证 `devtool` 时，我们期望的格式是 `[inline-|hidden-|eval-][nosources-][cheap-[module-]]source-map[-debugids]`.

## 推荐配置

### 开发环境

以下选项非常适合开发环境：

`eval` - 每个模块都使用 `eval()` 执行，并且都有 `//# sourceURL`。此选项的构建性能极快。主要缺点是，不会映射到原始代码。

`eval-source-map` - 每个模块使用 `eval()` 执行，并且将模块 source map 转换为 DataUrl 后添加到 `eval()` 中，避免 chunk 级 source map 合并计算。

`eval-cheap-source-map` - 类似 `eval-source-map`，每个模块使用 `eval()` 执行。source map 不计算列映射，只是映射行。忽略源自 loader 的 source map，仅映射到转译后的代码。

`eval-cheap-module-source-map` - 类似 `eval-cheap-source-map`，并且，但会处理 loader 的 source map，映射到原始代码。然而，source map 不计算列映射，只是映射行。

### 生产环境

这些选项通常用于生产环境中：

`false` - 不生成 source map。

`source-map` - source map 作为一个单独的文件生成。bundle 添加 `//# sourceMapURL` 注释，以便开发工具知道在哪里可以找到它。

:::warning
你应该配置你的服务器，不允许普通用户访问 source map 文件！
:::

`hidden-source-map` - 与 `source-map` 相同，但不会为 bundle 添加 `//# sourceMapURL` 注释。你可以将 source map 用于错误报告工具，映射源自客户端的错误堆栈，而不必暴露你的 source map。

`nosources-source-map` - 创建的 `source map` 不包含 `sourcesContent`（源代码内容）。用来映射客户端上的堆栈跟踪，而不会暴露原始代码，但仍然会暴露反编译后的文件名和结构。
